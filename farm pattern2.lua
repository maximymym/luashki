local v0={};local v1=nil;local v2=nil;local v3=0;local v4=10;local v5=0.2;local v6={};local v7={};local v8=Menu.Create("Scripts","User Scripts","Farm Pattern");local v9=v8:Create("Options"):Create("Main");local v10={};v10.enabled=v9:Switch("Show Farm Route",true,"\u{f0e7}");v10.ctrlToDrag=v9:Switch("Ctrl-Drag Stats Text",true,"\u{f0a9}");v10.optimized=v9:Switch("Show Optimal Path",true,"\u{f126}");v10.algorithm=v9:Combo("Algorithm",{"Greedy","Optimal (Advanced)"},1,"\u{f085}");v10.searchRadius=v9:Slider("Search Radius",500,6000,1500,function(v54) return tostring(v54);end);v10.allyRadius=v9:Slider("Ally Exclusion Radius",300,1000,600,function(v55) return tostring(v55);end);v10.pointsCount=v9:Slider("Points to Calculate",2,10,4,function(v56) return tostring(v56);end);v10.showVisualization=v9:Switch("Toggle Visualization",true,"\u{f021}");v10.visualColor=v9:ColorPicker("Visual Color",Color(0,255,128),"\u{f06e}");v10.circleSize=v9:Slider("Point Size",5,30,10,function(v57) return tostring(v57);end);v10.farmTimePerCreep=v9:Slider("Farm Time/Creep (s)",0.5,3,1,function(v58) return string.format("%.1f",v58);end);v10.minEfficiency=v9:Slider("Min Efficiency (g/s)",0,50,10,function(v59) return tostring(v59);end);v10.goldWeight=v9:Slider("Gold Weight",0.5,2,1,function(v60) return string.format("%.1f",v60);end);v10.xpWeight=v9:Slider("XP Weight",0,2,0.7,function(v61) return string.format("%.1f",v61);end);v10.dynamicUpdate=v9:Switch("Dynamic Route Updates",true,"\u{f021}");v10.checkpointCount=v9:Slider("Checkpoints per Path",1,10,5,function(v62) return tostring(v62);end);db.farmRouteIndicator=db.farmRouteIndicator or {} ;local v28=db.farmRouteIndicator;v28.x=v28.x or 10 ;v28.y=v28.y or 320 ;local v31=false;local v32=Vec2(0,0);local v33={};local v34={};local v35=0;local v36=1;local v37=nil;local function v38() local v63=GameRules.GetGameTime() -GameRules.GetGameStartTime() ;if (v63<0) then v63=0;end return v63;end local function v39() if  not v1 then v1=Heroes.GetLocal();end return v1;end local function v40() if  not v2 then local v188=Players.GetLocal();local v189=Player.GetPlayerSlot(v188);v2=((v189<5) and Enum.TeamNum.TEAM_RADIANT) or Enum.TeamNum.TEAM_DIRE ;end return v2;end local function v41(v64) local v65=0;if v64 then for v223 in pairs(v64) do v65=v65 + 1 ;end end return v65;end local function v42(v66) local v67=v39();local v68=v66.creepCount or 0 ;if (v68==0) then if (v66.gold>150) then v68=5;elseif (v66.gold>100) then v68=4;else v68=3;end end local v69=NPC.GetTrueDamage(v67);local v70=NPC.GetAttackSpeed(v67);local v71=v69 * v70 ;local v72=300;local v73={"juggernaut_blade_fury","axe_counter_helix","antimage_blink","phantom_assassin_stifling_dagger","luna_moon_glaive","sven_great_cleave"};local v74=false;for v138,v139 in ipairs(v73) do local v140=NPC.GetAbility(v67,v139);if (v140 and Ability.IsReady(v140)) then v74=true;break;end end local v75=v68 * (v72/math.max(50,v71)) ;if v74 then v75=v75 * 0.6 ;end return math.max(v75,v68 * v10.farmTimePerCreep:Get() );end local function v43(v76,v77,v78) local v79={};for v141=1,v78 do local v142=v141/(v78 + 1) ;local v143=v76.x + ((v77.x-v76.x) * v142) ;local v144=v76.y + ((v77.y-v76.y) * v142) ;local v145=v76.z + ((v77.z-v76.z) * v142) ;table.insert(v79,Vector(v143,v144,v145));end return v79;end local function v44(v80,v81) local v82=v39();if  not v82 then return false;end local v83=v40();local v84=Heroes.InRadius(v80,v81,v83,Enum.TeamType.TEAM_FRIEND);for v146,v147 in ipairs(v84) do if ((v147~=v82) and Entity.IsAlive(v147)) then return true;end end return false;end local function v45(v85,v86,v87) local v88={};local v89=Entity.GetAbsOrigin(v85);if ( #v86>0) then table.insert(v88,v43(v89,v86[1].pos,v87));end for v148=1, #v86-1  do table.insert(v88,v43(v86[v148].pos,v86[v148 + 1 ].pos,v87));end return v88;end local function v46() for v149,v150 in ipairs(v7) do v6[v149]=v6[v149] or {} ;for v190,v191 in ipairs(v150) do local v192=v6[v149][v190] or Vector(v191.x,v191.y,v191.z) ;v192.x=v192.x + ((v191.x-v192.x) * v5) ;v192.y=v192.y + ((v191.y-v192.y) * v5) ;v192.z=v192.z + ((v191.z-v192.z) * v5) ;v6[v149][v190]=v192;end end end local function v47() local v90=v39();if  not v90 then return {};end local v91=Entity.GetAbsOrigin(v90);local v92=NPC.GetMoveSpeed(v90);local v93={};for v152,v153 in ipairs(v33) do local v154=v153.gold * 0.8 ;table.insert(v93,{pos=v153.pos,gold=v153.gold,xp=v154,creepCount=v153.creepCount,isJungle=v153.isJungle});end local v94={};local v95=v91;local v96=v10.minEfficiency:Get();local v97=v10.pointsCount:Get();local v98=v10.goldWeight:Get();local v99=v10.xpWeight:Get();while ( #v93>0) and ( #v94<v97)  do local v155,v156=nil,0;for v197,v198 in ipairs(v93) do local v199=GridNav.GetTravelTime(v95,v198.pos,false,nil,v92);local v200=v42(v198);local v201=(v198.gold * v98) + (v198.xp * v99) ;local v202=v201/(v199 + v200) ;if ((v202>=v96) and (v202>v156)) then v156,v155=v202,v197;end end if  not v155 then break;end table.insert(v94,v93[v155]);v95=v93[v155].pos;table.remove(v93,v155);end return v94;end local function v48() local v100=v39();if  not v100 then return {};end local v101=Entity.GetAbsOrigin(v100);local v102=NPC.GetMoveSpeed(v100);local v103={};local v104=v10.goldWeight:Get();local v105=v10.xpWeight:Get();for v158,v159 in ipairs(v33) do local v160=v159.gold * 0.8 ;local v161=GridNav.GetTravelTime(v101,v159.pos,false,nil,v102);local v162=v42({pos=v159.pos,gold=v159.gold,creepCount=v159.creepCount,isJungle=v159.isJungle});local v163=((v159.gold * v104) + (v160 * v105))/(v161 + v162) ;if (v163>=v10.minEfficiency:Get()) then table.insert(v103,{pos=v159.pos,gold=v159.gold,xp=v160,creepCount=v159.creepCount,eff=v163,isJungle=v159.isJungle});end end local v106=math.min(8, #v103);table.sort(v103,function(v164,v165) return v164.eff>v165.eff ;end);if ( #v103>v106) then local v203={};for v224=1,v106 do v203[v224]=v103[v224];end v103=v203;end local function v107(v166,v167) if (v167<=0) then return 0;end local v168,v169=0,0;for v204,v205 in ipairs(v166) do v168=v168 + v205.gold ;v169=v169 + v205.xp ;end return ((v168 * v104) + (v169 * v105))/v167 ;end local function v108(v170,v171,v172,v173,v174) if ((v174>=v10.pointsCount:Get()) or ( #v170==0)) then return v172,v107(v172,v173);end local v175,v176=v172,v107(v172,math.max(0.1,v173));for v206,v207 in ipairs(v170) do local v208={};for v227,v228 in ipairs(v170) do if (v206~=v227) then table.insert(v208,v228);end end local v209=GridNav.GetTravelTime(v171,v207.pos,false,nil,v102);local v210=v42(v207);local v211=v173 + v209 + v210 ;local v212={table.unpack(v172)};table.insert(v212,v207);local v213,v214=v108(v208,v207.pos,v212,v211,v174 + 1 );if (v214>v176) then v175,v176=v213,v214;end end return v175,v176;end local v109,v110=v108(v103,v101,{},0,0);return v109;end local function v49() if (v10.algorithm:Get()==1) then return v47();else return v48();end end local v50=Enum.ButtonCode.KEY_LCONTROL;local v51=Enum.ButtonCode.KEY_MOUSE1;v0.OnUpdate=function() if  not v10.enabled:Get() then return;end local v111=v39();if ( not v111 or  not Entity.IsAlive(v111)) then return;end local v112=GameRules.GetGameTime();local v113=Entity.GetAbsOrigin(v111);if ((v112-v35)>=0.1) then v35=v112;v33={};local v215={};local v216,v217=v10.searchRadius:Get(),v10.allyRadius:Get();if (LIB_HEROES_DATA and LIB_HEROES_DATA.lane_creeps_groups) then for v241,v242 in ipairs(LIB_HEROES_DATA.lane_creeps_groups) do local v243=v242.position;if ((v243-v113):Length2D()<=v216) then local v254=0;for v261,v262 in pairs(v242.creeps) do v254=v254 + NPC.GetGoldBounty(v262) ;end local v255=tostring(v243);if ((v254>0) and  not v215[v255] and  not v44(v243,v217)) then v215[v255]=true;table.insert(v33,{pos=v243,gold=v254,isJungle=false,creepCount=v41(v242.creeps)});end end end end if (LIB_HEROES_DATA and LIB_HEROES_DATA.jungle_spots) then for v244,v245 in ipairs(LIB_HEROES_DATA.jungle_spots) do local v246=v245.pos or ((v245.box.min + v245.box.max) * 0.5) ;if ((v246-v113):Length2D()<=v216) then local v256=Camp.GetGoldBounty(v245,true);local v257=tostring(v246);if ((v256>0) and  not v215[v257] and  not v44(v246,v217)) then v215[v257]=true;table.insert(v33,{pos=v246,gold=v256,isJungle=true});end end end end if v10.optimized:Get() then v34=v49();v7=v45(v111,v34,v10.checkpointCount:Get());if ( #v6~= #v7) then v6={};for v258,v259 in ipairs(v7) do v6[v258]={};for v263,v264 in ipairs(v259) do v6[v258][v263]=Vector(v264.x,v264.y,v264.z);end end end v36=1;v37=v113;else v34={};v7={};v6={};v36=1;end end end;v0.OnDraw=function() if  not v10.enabled:Get() then return;end local v114=v39();if ( not v114 or  not Entity.IsAlive(v114)) then return;end if ( not v10.optimized:Get() or ( #v34==0)) then return;end v46();local v115=v38();local v116=math.floor(v115%60 );local v117=Entity.GetAbsOrigin(v114);local v118,v119=Render.WorldToScreen(v117);local v120=(v10.showVisualization:Get() and 255) or 0 ;if (v3<v120) then v3=math.min(v3 + v4 ,v120);elseif (v3>v120) then v3=math.max(v3-v4 ,v120);end if (v3<=0) then return;end local v121=math.floor(v3);local v122=math.min(v10.pointsCount:Get(), #v34);local v123=0;for v177=1,v122 do v123=v123 + v34[v177].gold ;end local v124=string.format("Farm Path: %d point(s), ~%d gold",v122,math.floor(v123));local v125,v126=Renderer.GetTextSize(1,v124);local v127,v128=Input.GetCursorPos();local v129=Vec2(v127,v128);local v130=Vec2(v28.x,v28.y);local v131=Vec2(v28.x + v125 ,v28.y + v126 );if (v10.ctrlToDrag:Get() and Input.IsKeyDown(v50) and Input.IsKeyDownOnce(v51) and (v129.x>=v130.x) and (v129.x<=v131.x) and (v129.y>=v130.y) and (v129.y<=v131.y)) then v31=true;v32=v130-v129 ;end if (v31 and Input.IsKeyDown(v51)) then local v218,v219=Input.GetCursorPos();v28.x=v218 + v32.x ;v28.y=v219 + v32.y ;end if (v31 and  not Input.IsKeyDown(v51)) then v31=false;end Renderer.SetDrawColor(255,255,255,v121);Renderer.DrawText(1,v28.x,v28.y,v124);if v10.dynamicUpdate:Get() then local v222=v6;if (v36<= #v222) then for v247,v248 in ipairs(v222[v36]) do local v249,v250=Render.WorldToScreen(v248);if v250 then Renderer.SetDrawColor(255,165,0,v121);Renderer.DrawFilledCircle(v249.x,v249.y,5);end end end for v229=v36 + 1 , #v222 do for v237,v238 in ipairs(v222[v229]) do local v239,v240=Render.WorldToScreen(v238);if v240 then Renderer.SetDrawColor(255,165,0,math.floor(v121 * 0.5 ));Renderer.DrawFilledCircle(v239.x,v239.y,3);end end end end local v132=v10.visualColor:Get();local v133,v134,v135=math.floor(v132.r),math.floor(v132.g),math.floor(v132.b);local v136,v137;for v178=1,v122 do local v179=v34[v178];local v180,v181=Render.WorldToScreen(v179.pos);local v182,v183,v184=v133,v134,v135;local v185,v186=false,nil;if ((v178==1) and v179.isJungle and (v116>=45) and (v116<=56)) then v185=true;v182=255 -v133 ;v183=255 -v134 ;v184=255 -v135 ;if (v116<=53) then v186=tostring(53 -v116 );end end if v181 then local v230=v10.circleSize:Get();Renderer.SetDrawColor(v182,v183,v184,v121);Renderer.DrawFilledCircle(v180.x,v180.y,v230);local v231=tostring(v178);local v232,v233=Renderer.GetTextSize(1,v231);Renderer.SetDrawColor(255,255,255,v121);Renderer.DrawText(1,v180.x-(v232 * 0.5) ,v180.y-(v233 * 0.5) ,v231);if v185 then local v251="STACK!";if v186 then v251=v251   .. " "   .. v186 ;end local v252,v253=Renderer.GetTextSize(1,v251);Renderer.SetDrawColor(v182,v183,v184,v121);Renderer.DrawText(1,v180.x-(v252 * 0.5) ,((v180.y-v230) -v253) -2 ,v251);end local v234=tostring(math.floor(v179.gold));local v235,v236=Renderer.GetTextSize(1,v234);Renderer.SetDrawColor(255,215,0,v121);Renderer.DrawText(1,v180.x-(v235 * 0.5) ,v180.y + v230 + 2 ,v234);end local v187;if (v178==1) then v187=v119 or v181 ;if v187 then Renderer.SetDrawColor(v182,v183,v184,v121);Renderer.DrawLine(v118.x,v118.y,v180.x,v180.y);end else v187=v137 or v181 ;if v187 then Renderer.SetDrawColor(v182,v183,v184,v121);Renderer.DrawLine(v136.x,v136.y,v180.x,v180.y);end end v136,v137=v180,v181;end end;return {OnUpdate=v0.OnUpdate,OnDraw=v0.OnDraw};